// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test, console} from "forge-std/Test.sol";
import {EC, ECPoint} from "../src/EC.sol";

contract ECTest is Test {
    EC public ec;

    function setUp() public {
        ec = new EC();
    }

    function test_rationalAdd() external {
        {
            // "12" + 97 = 109
            ECPoint memory A = ECPoint(
                // Malformed x value
                17108685722251241369314020928988529881027530433467445791267465866135602972754,
                20666112440056908034039013737427066139426903072479162670940363761207457724060
            );
            ECPoint memory B = ECPoint(
                5060549300900576002438537256617533285303175982423725591354110924059445776301,
                21432174468722130278193150581548751041331147035316420546597625954751666563889
            );
            vm.expectRevert("Invalid EC Points");
            ec.rationalAdd(A, B, 109, 1);
        }
        {
            // 13 + 97 != 109
            ECPoint memory A = ECPoint(
                2672242651313367459976336264061690128665099451055893690004467838496751824703,
                18247534626997477790812670345925575171672701304065784723769023620148097699216
            );
            ECPoint memory B = ECPoint(
                5060549300900576002438537256617533285303175982423725591354110924059445776301,
                21432174468722130278193150581548751041331147035316420546597625954751666563889
            );

            assertFalse(ec.rationalAdd(A, B, 109, 1));
        }
        {
            // 12 + 97 = 109
            ECPoint memory A = ECPoint(
                17108685722251241369314020928988529881027530433467445791267465866135602972753,
                20666112440056908034039013737427066139426903072479162670940363761207457724060
            );
            ECPoint memory B = ECPoint(
                5060549300900576002438537256617533285303175982423725591354110924059445776301,
                21432174468722130278193150581548751041331147035316420546597625954751666563889
            );

            assertTrue(ec.rationalAdd(A, B, 109, 1));
        }
        {
            // 12/47 + 33/48 = 709/752
            ECPoint memory A = ECPoint(
                12128416201425586622560549136756833541677226724755842857149169194444003774891,
                10716236668643904157825611563182236788643420177660645656726006020062202748022
            );
            ECPoint memory B = ECPoint(
                16099420920581702255175293724868659223567756114032025470083056370421188271727,
                9750807591715237082474515017943621170174530282279931935262470395760951492455
            );

            assertTrue(ec.rationalAdd(A, B, 709, 752));
        }
    }
}
